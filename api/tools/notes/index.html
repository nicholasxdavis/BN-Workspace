<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Notes - Blacnova Workspace</title>
    <link rel="icon" href="https://www.blacnova.net/img/bn_orange.png" type="image/png">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js" defer></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        :root { --primary: #d4611c; --dark-bg: #101010; --card-bg: #1a1a1a; --border-color: rgba(255, 255, 255, 0.1); }
        body { font-family: 'Inter', sans-serif; background-color: var(--dark-bg); color: #EEEEEE; }
        [x-cloak] { display: none !important; }
        .editor-input { background: transparent; border: none; color: white; width: 100%; outline: none; }
    </style>
</head>
<body x-data="notesApp()" x-init="init()" class="h-screen flex flex-col">

    <header class="bg-card-bg border-b border-border-color p-4 flex justify-between items-center flex-shrink-0">
        <h1 class="text-xl font-bold flex items-center"><i class="fas fa-sticky-note text-2xl mr-3 text-primary"></i>Notes</h1>
        <a href="../.." class="text-sm text-gray-400 hover:text-white transition-colors flex items-center"><i class="fas fa-arrow-left mr-2"></i>Back to Workspace</a>
    </header>

    <div class="flex flex-1 overflow-hidden">
        <aside class="w-1/3 md:w-1/4 bg-card-bg border-r border-border-color flex flex-col">
            <div class="p-4 border-b border-border-color">
                <button @click="createNewNote()" class="w-full bg-primary text-white font-bold py-2 px-4 rounded-lg hover:bg-opacity-80 transition">
                    <i class="fas fa-plus mr-2"></i>New Note
                </button>
            </div>
            <div class="flex-1 overflow-y-auto">
                <template x-for="note in notes" :key="note.id">
                    <div @click="selectNote(note)" 
                         class="p-4 cursor-pointer border-l-4"
                         :class="{ 'bg-primary/20 border-primary': activeNote && activeNote.id === note.id, 'border-transparent hover:bg-white/5': !activeNote || activeNote.id !== note.id }">
                        <h3 class="font-bold truncate" x-text="note.title"></h3>
                        <p class="text-sm text-gray-400 truncate" x-text="note.snippet || 'No content'"></p>
                    </div>
                </template>
            </div>
        </aside>

        <main class="flex-1 flex flex-col p-4 md:p-8">
            <template x-if="activeNote">
                <div class="flex flex-col h-full">
                    <div class="flex justify-between items-center mb-4">
                        <input type="text" x-model="activeNote.title" @input.debounce.500ms="saveNote" class="editor-input text-3xl font-bold" placeholder="Note Title">
                        <button @click="deleteNote(activeNote.id)" class="text-gray-400 hover:text-red-500 transition"><i class="fas fa-trash"></i></button>
                    </div>
                    <textarea x-model="activeNote.content" @input.debounce.500ms="saveNote" class="editor-input flex-1 resize-none text-lg" placeholder="Start writing..."></textarea>
                </div>
            </template>
            <template x-if="!activeNote">
                <div class="flex-1 flex items-center justify-center text-center text-gray-500">
                    <div>
                        <i class="fas fa-sticky-note text-6xl mb-4"></i>
                        <h2 class="text-2xl">Select a note to view or create a new one.</h2>
                    </div>
                </div>
            </template>
        </main>
    </div>

    <script>
        function notesApp() {
            return {
                notes: [],
                activeNote: null,
                
                async init() {
                    this.fetchNotes();
                },
                
                async fetchNotes() {
                    const response = await fetch('./notes_api.php?action=get_notes');
                    const data = await response.json();
                    if (data.success) {
                        this.notes = data.notes;
                    }
                },
                
                async selectNote(note) {
                    const response = await fetch(`./notes_api.php?action=get_note&id=${note.id}`);
                    const data = await response.json();
                    if (data.success) {
                        this.activeNote = data.note;
                    }
                },
                
                async createNewNote() {
                    const response = await fetch('./notes_api.php?action=create_note', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ title: 'Untitled Note', content: '' })
                    });
                    const data = await response.json();
                    if(data.success) {
                        this.activeNote = data.note;
                        this.fetchNotes(); // Refresh list
                    }
                },

                async saveNote() {
                    if (!this.activeNote) return;
                    await fetch('./notes_api.php?action=update_note', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(this.activeNote)
                    });
                    // Refresh the snippet in the list
                    const noteInList = this.notes.find(n => n.id === this.activeNote.id);
                    if (noteInList) {
                        noteInList.title = this.activeNote.title;
                        noteInList.snippet = this.activeNote.content.substring(0, 100);
                    }
                },
                
                async deleteNote(id) {
                    if (confirm('Are you sure you want to delete this note?')) {
                        await fetch('./notes_api.php?action=delete_note', {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({ id: id })
                        });
                        this.activeNote = null;
                        this.fetchNotes();
                    }
                }
            }
        }
    </script>
</body>
</html>