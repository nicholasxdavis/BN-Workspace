<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reddit Integration - Blacnova Workspace</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary: #d4611c;
            --dark-bg: #101010;
            --card-bg: #1a1a1a;
            --text-primary: #EEEEEE;
        }
        body {
            background-color: var(--dark-bg);
            color: var(--text-primary);
        }
        .chat-bubble {
            max-width: 75%;
            padding: 10px 15px;
            border-radius: 20px;
        }
        .user-bubble {
            background-color: var(--primary);
            color: white;
            align-self: flex-end;
        }
        .ai-bubble {
            background-color: var(--card-bg);
            color: var(--text-primary);
            align-self: flex-start;
        }
    </style>
</head>
<body class="flex flex-col h-screen p-4">

    <header class="mb-4 text-center">
        <h1 class="text-2xl font-bold"><i class="fab fa-reddit-alien" style="color: #FF4500;"></i> Reddit Integration</h1>
        <p class="text-sm text-gray-400">AI-powered assistance for your Reddit activities.</p>
    </header>

    <main id="chat-container" class="flex-1 overflow-y-auto p-4 space-y-4 bg-black/20 rounded-lg">
        </main>

    <footer class="mt-4">
        <form id="chat-form" class="flex items-center">
            <input type="text" id="chat-input" class="flex-1 p-3 bg-gray-800 border border-gray-700 rounded-l-lg focus:outline-none focus:ring-2 focus:ring-[var(--primary)]" placeholder="Ask the AI anything about Reddit...">
            <button type="submit" class="bg-[var(--primary)] px-5 py-3 rounded-r-lg text-white font-semibold">
                <i class="fas fa-paper-plane"></i>
            </button>
        </form>
    </footer>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const chatContainer = document.getElementById('chat-container');
            const chatForm = document.getElementById('chat-form');
            const chatInput = document.getElementById('chat-input');

            const OPENROUTER_API_KEY = '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';
            const MODELS = [
                'deepseek/deepseek-chat-v3.1:free',
                'x-ai/grok-4-fast:free',
                'nvidia/nemotron-nano-9b-v2:free',
                'openai/gpt-oss-120b:free',
                'qwen/qwen3-coder:free',
                'moonshotai/kimi-k2:free',
                'google/gemma-3n-e2b-it:free',
                'meta-llama/llama-3.3-8b-instruct:free'
            ];

            chatForm.addEventListener('submit', async (e) => {
                e.preventDefault();
                const userInput = chatInput.value.trim();
                if (!userInput) return;

                appendMessage(userInput, 'user');
                chatInput.value = '';

                try {
                    const aiResponse = await getAIResponse(userInput);
                    appendMessage(aiResponse, 'ai');
                } catch (error) {
                    console.error("Error getting AI response:", error);
                    appendMessage('Sorry, I seem to be having trouble connecting. Please try again later.', 'ai');
                }
            });

            function appendMessage(text, sender) {
                const bubble = document.createElement('div');
                bubble.classList.add('chat-bubble', sender === 'user' ? 'user-bubble' : 'ai-bubble');
                bubble.textContent = text;
                chatContainer.appendChild(bubble);
                chatContainer.scrollTop = chatContainer.scrollHeight;
            }

            async function getAIResponse(prompt, modelIndex = 0) {
                if (modelIndex >= MODELS.length) {
                    throw new Error("All models are unavailable.");
                }

                const currentModel = MODELS[modelIndex];

                const response = await fetch("https://openrouter.ai/api/v1/chat/completions", {
                    method: "POST",
                    headers: {
                        "Authorization": \`Bearer \${OPENROUTER_API_KEY}\`,
                        "Content-Type": "application/json"
                    },
                    body: JSON.stringify({
                        "model": currentModel,
                        "messages": [
                            { "role": "system", "content": "You are an AI assistant integrated into a Reddit workspace. Be helpful and concise." },
                            { "role": "user", "content": prompt }
                        ]
                    })
                });

                if (!response.ok) {
                    console.warn(\`Model \${currentModel} failed. Trying next one.\`);
                    return getAIResponse(prompt, modelIndex + 1); // Try the next model
                }

                const data = await response.json();
                return data.choices[0].message.content;
            }

            // Initial AI message
            appendMessage("Hello! I'm your AI assistant for Reddit. How can I help you today?", 'ai');
        });
    </script>
</body>
</html>