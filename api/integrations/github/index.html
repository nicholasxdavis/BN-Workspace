<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GitHub Tool - Blacnova Workspace</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js" defer></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&family=Space+Grotesk:wght@500;700&display=swap" rel="stylesheet">
    <style>
        :root { --primary: #9ca3af; --primary-light: #d1d5db; --dark-bg: #101010; --card-bg: #1a1a1a; --border-color: rgba(255, 255, 255, 0.1); --text-primary: #EEEEEE; --text-secondary: #a1a1aa; }
        body { font-family: 'Inter', sans-serif; background-color: var(--dark-bg); color: var(--text-primary); }
        .sidebar-link.active, .sidebar-link:hover { background-color: rgba(255, 255, 255, 0.05); color: var(--text-primary); }
        .sidebar-link.active { box-shadow: inset 3px 0 0 0 var(--primary); }
        [x-cloak] { display: none !important; }
        .loader { border: 4px solid rgba(255, 255, 255, 0.2); border-left-color: var(--primary); border-radius: 50%; width: 24px; height: 24px; animation: spin 1s linear infinite; }
        @keyframes spin { to { transform: rotate(360deg); } }
        .main-content-card { background: linear-gradient(135deg, rgba(26,26,26,0.5) 0%, rgba(10,10,10,0.6) 100%); border: 1px solid rgba(255,255,255,0.1); border-radius: 1.5rem; padding: 2.5rem; backdrop-filter: blur(10px); }
        .stat-card { background-color: #161618; border-radius: 1rem; padding: 1.5rem; border: 1px solid var(--border-color); transition: all 0.3s ease; }
        .stat-card:hover { transform: translateY(-4px); border-color: var(--primary); }
    </style>
</head>
<body class="h-screen flex" x-data="githubTool()" x-init="init()">
    <aside class="w-64 bg-[var(--card-bg)]/80 backdrop-blur-lg border-r border-[var(--border-color)] flex flex-col flex-shrink-0 z-10">
        <div class="p-6 border-b border-[var(--border-color)]">
             <h1 class="text-xl font-bold flex items-center"><i class="fab fa-github text-2xl mr-3"></i>GitHub Tool</h1>
             <p class="text-xs text-gray-400 mt-1">Blacnova Workspace</p>
        </div>
        <nav class="flex-1 p-4 space-y-2">
            <a href="#" @click.prevent="activeTab = 'dashboard'" class="sidebar-link flex items-center px-4 py-2 rounded-lg" :class="{ 'active': activeTab === 'dashboard' }"><i class="fas fa-home w-6"></i><span>Dashboard</span></a>
            <a href="#" @click.prevent="switchTab('repos')" class="sidebar-link flex items-center px-4 py-2 rounded-lg" :class="{ 'active': activeTab === 'repos' }"><i class="fas fa-book-bookmark w-6"></i><span>Repositories</span></a>
        </nav>
        <div class="p-4 border-t border-[var(--border-color)]">
             <a href="../.." class="text-sm text-gray-400 hover:text-white transition-colors flex items-center"><i class="fas fa-arrow-left mr-2"></i> Back to Workspace</a>
        </div>
    </aside>

    <main class="flex-1 p-8 overflow-y-auto">
        <div x-show="activeTab === 'dashboard'" x-cloak>
             <div class="flex items-center mb-12">
                <img :src="stats.avatar_url" class="w-24 h-24 rounded-full border-2 border-primary mr-6">
                <div>
                    <h1 class="text-4xl md:text-5xl font-medium text-white" x-text="stats.name"></h1>
                    <p class="text-lg text-gray-400" x-text="'@' + stats.login"></p>
                </div>
            </div>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <div class="stat-card"><h3 class="text-sm font-medium uppercase text-gray-400">Public Repos</h3><p class="text-4xl font-bold" x-text="stats.public_repos"></p></div>
                <div class="stat-card"><h3 class="text-sm font-medium uppercase text-gray-400">Followers</h3><p class="text-4xl font-bold" x-text="stats.followers"></p></div>
                <div class="stat-card"><h3 class="text-sm font-medium uppercase text-gray-400">Following</h3><p class="text-4xl font-bold" x-text="stats.following"></p></div>
            </div>
             <div class="main-content-card">
                <h3 class="text-xl font-bold mb-4">Recently Pushed Repositories</h3>
                 <div x-show="dashboardLoading" class="flex justify-center items-center h-48"><div class="loader"></div></div>
                 <div x-show="!dashboardLoading" class="space-y-4">
                    <template x-for="repo in recentRepos" :key="repo.id">
                         <a :href="repo.html_url" target="_blank" class="flex justify-between items-center p-4 bg-[#2a2a2a] rounded-xl hover:bg-white/10 transition-colors">
                            <div>
                                <p class="font-semibold text-primary-light" x-text="repo.full_name"></p>
                                <p class="text-sm text-gray-400" x-text="repo.description || 'No description'"></p>
                            </div>
                            <div class="text-right flex-shrink-0 ml-4">
                                <span class="text-sm"><i class="fas fa-star mr-1"></i> <span x-text="repo.stargazers_count"></span></span>
                            </div>
                        </a>
                    </template>
                </div>
            </div>
        </div>

        <div x-show="activeTab === 'repos'" x-cloak>
             <div class="text-center mb-12"><h1 class="text-4xl md:text-5xl font-medium text-white">Your Repositories</h1></div>
             <div class="main-content-card">
                <div x-show="isLoading" class="flex justify-center h-64 items-center"><div class="loader !w-12 !h-12"></div></div>
                <div x-show="!isLoading" class="space-y-4">
                     <template x-for="repo in repos" :key="repo.id">
                        <a :href="repo.html_url" target="_blank" class="flex items-start p-4 bg-[#2a2a2a] rounded-xl hover:bg-white/10 transition-colors">
                            <i class="fas fa-book-bookmark text-primary-light mt-1 mr-4"></i>
                            <div class="flex-1">
                                <h4 class="font-bold" x-text="repo.full_name"></h4>
                                <p class="text-sm text-gray-400 my-1" x-text="repo.description || 'No description provided.'"></p>
                                <div class="flex items-center space-x-4 text-xs text-gray-500 mt-2">
                                    <span x-show="repo.language"><i class="fas fa-circle mr-1" :style="{ color: languageColor(repo.language) }"></i> <span x-text="repo.language"></span></span>
                                    <span><i class="fas fa-star mr-1"></i> <span x-text="repo.stargazers_count"></span></span>
                                    <span><i class="fas fa-code-branch mr-1"></i> <span x-text="repo.forks_count"></span></span>
                                    <span>Updated <span x-text="formatDate(repo.updated_at)"></span></span>
                                </div>
                            </div>
                        </a>
                     </template>
                </div>
             </div>
        </div>
    </main>

    <script>
    function githubTool() {
        return {
            activeTab: 'dashboard',
            dashboardLoading: true,
            isLoading: true,
            stats: { name: '...', login: '...', avatar_url: '', public_repos: '...', followers: '...', following: '...' },
            recentRepos: [],
            repos: [],
            
            async init() {
                await this.loadDashboardData();
            },
            async switchTab(tab) {
                this.activeTab = tab;
                if (tab === 'repos' && this.repos.length === 0) {
                    this.loadRepos();
                }
            },
            async loadDashboardData() {
                this.dashboardLoading = true;
                try {
                    const r = await fetch('./github_api.php?action=dashboard_data');
                    const d = await r.json();
                    if (!d.success) throw new Error(d.error || 'Failed to load dashboard data.');
                    this.stats = d.stats;
                    this.recentRepos = d.recent_repos;
                } catch (e) {
                    alert(`Error: ${e.message}`);
                } finally {
                    this.dashboardLoading = false;
                }
            },
            async loadRepos() {
                this.isLoading = true;
                try {
                    const r = await fetch('./github_api.php?action=list_repos');
                    const d = await r.json();
                    if (!d.success) throw new Error(d.error || 'Failed to load repositories.');
                    this.repos = d.data;
                } catch (e) {
                    alert(`Error: ${e.message}`);
                } finally {
                    this.isLoading = false;
                }
            },
            formatDate(dateString) {
                const date = new Date(dateString);
                return date.toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' });
            },
            languageColor(lang) {
                // Simple mapping for common languages. A more robust solution would be a larger map.
                const colors = { 'JavaScript': '#f1e05a', 'HTML': '#e34c26', 'CSS': '#563d7c', 'PHP': '#4F5D95', 'Python': '#3572A5', 'Java': '#b07219', 'TypeScript': '#2b7489', 'Shell': '#89e051' };
                return colors[lang] || '#ccc';
            }
        }
    }
    </script>
</body>
</html>